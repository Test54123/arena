<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Arena</title>

  <style>
    body{
      font-family: monospace;
      background:#dfe9d6;
      padding:14px;
    }
    h2{ margin-bottom:12px; }
    .card{
      background:#fffdf1;
      border:2px solid #6a7b5f;
      border-radius:12px;
      padding:12px;
      margin-bottom:14px;
    }
    input,button{
      width:100%;
      padding:10px;
      margin-top:6px;
      border-radius:10px;
      border:1px solid #6a7b5f;
      font-size:16px;
      box-sizing:border-box;
    }
    button{
      cursor:pointer;
      background:#eee;
      font-weight:bold;
    }
    button:disabled{
      opacity:0.4;
      cursor:not-allowed;
    }
    #log{
      background:black;
      color:#00ff00;
      padding:10px;
      border-radius:10px;
      min-height:140px;
      white-space:pre-wrap;
      font-size:14px;
    }
  </style>
</head>

<body>
  <h2>üè∞ Arena</h2>

  <div class="card">
    <h3>Join Room</h3>
    Room Code:
    <input id="room" value="ARENA"/>
    Password:
    <input id="pass" value="rose"/>

    <button onclick="connectHost()">Host (Play)</button>
    <button onclick="connectSpectate()">Spectate (Watch)</button>
  </div>

  <div class="card">
    <h3>Players</h3>
    Player A:
    <input id="a" value="PlayerA"/>
    Player B:
    <input id="b" value="PlayerB"/>

    <button onclick="startMatch()">Start Match</button>

    <button id="shareBtn" disabled onclick="shareResult()">
      Share Result üì≤
    </button>
  </div>

  <div class="card">
    <h3>Battle Log</h3>
    <div id="log">Not connected.</div>
  </div>

  <!-- Socket.IO client served from your server -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io(); // ‚úÖ correct for Render (no localhost)

    let lastResult = "";

    function log(msg){
      const box = document.getElementById("log");
      if (box.textContent === "Not connected.") box.textContent = "";
      box.textContent += (box.textContent ? "\n" : "") + msg;
      box.scrollTop = box.scrollHeight;
    }

    socket.on("connect", ()=>{
      log("‚úÖ Connected to server!");
    });

    socket.on("disconnect", ()=>{
      log("‚ùå Disconnected.");
    });

    socket.on("joined", ({ role, room })=>{
      log(`‚úÖ Joined as ${role} in room: ${room}`);
    });

    socket.on("errorMsg", ({ error })=>{
      log("‚ö†Ô∏è " + error);
      alert(error);
    });

    // ‚úÖ THIS is what the spectator needs
    socket.on("matchResult", ({ result })=>{
      log("üì£ MATCH RESULT RECEIVED:");
      log(result);
    });

    function connectHost(){
      const room = document.getElementById("room").value.trim();
      const pass = document.getElementById("pass").value.trim();
      socket.emit("hostRoom", { room, pass });
      log("üéÆ Hosting room: " + room);
    }

    function connectSpectate(){
      const room = document.getElementById("room").value.trim();
      const pass = document.getElementById("pass").value.trim();
      socket.emit("spectateRoom", { room, pass });
      log("üëÄ Watching room: " + room);
    }

    function startMatch(){
      const room = document.getElementById("room").value.trim();
      const password = document.getElementById("pass").value.trim();

      const A = document.getElementById("a").value.trim();
      const B = document.getElementById("b").value.trim();
      if(!A || !B){
        alert("Please enter both player names!");
        return;
      }

      const winner = Math.random() > 0.5 ? A : B;
      lastResult = `üèÜ Winner: ${winner}\n(${A} vs ${B})`;

      log("‚öîÔ∏è Match started...");
      log("üì§ Sending result...");

      socket.emit("matchResult", { room, password, result: lastResult });

      document.getElementById("shareBtn").disabled = false;
    }

    function shareResult(){
      if(!lastResult) return;

      if(navigator.share){
        navigator.share({
          title: "Arena Match Result",
          text: lastResult
        });
      } else {
        alert("Sharing not supported on this device.");
      }
    }
  </script>
</body>
</html>
