<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Arena</title>

  <style>
    body{
      font-family: monospace;
      background:#dfe9d6;
      padding:14px;
    }
    h2{ margin-bottom:12px; }
    .card{
      background:#fffdf1;
      border:2px solid #6a7b5f;
      border-radius:12px;
      padding:12px;
      margin-bottom:14px;
    }
    input,button,select{
      width:100%;
      padding:10px;
      margin-top:6px;
      border-radius:10px;
      border:1px solid #6a7b5f;
      font-size:16px;
      box-sizing:border-box;
    }
    button{
      cursor:pointer;
      background:#eee;
      font-weight:bold;
    }
    button:disabled{ opacity:0.4; cursor:not-allowed; }
    #log{
      background:black;
      color:#00ff00;
      padding:10px;
      border-radius:10px;
      min-height:160px;
      white-space:pre-wrap;
      font-size:14px;
      overflow:auto;
      max-height:260px;
    }
    .row{
      display:flex;
      gap:10px;
    }
    .row > *{ flex:1; }
    .pill{
      display:inline-block;
      padding:4px 8px;
      border:1px solid #6a7b5f;
      border-radius:999px;
      background:#eef2e7;
      margin-right:6px;
      margin-bottom:6px;
    }
  </style>
</head>
<body>

<h2>üè∞ Arena</h2>

<div class="card">
  <h3>Room</h3>

  Room Code:
  <input id="room" value="ARENA"/>

  Password:
  <input id="pass" value="rose"/>

  <div class="row">
    <button onclick="hostRoom()">Host (Create)</button>
    <button onclick="spectate()">Spectate</button>
  </div>

  <hr/>

  <h3>Join as Player</h3>

  Your name:
  <input id="myName" value="Player"/>

  Seat:
  <select id="seat">
    <option value="A">Player A</option>
    <option value="B">Player B</option>
  </select>

  <button onclick="joinPlayer()">Join Player Seat</button>

  <div style="margin-top:10px">
    <span class="pill" id="statusPill">Status: not connected</span>
    <span class="pill" id="rolePill">Role: -</span>
  </div>
</div>

<div class="card">
  <h3>Game</h3>

  <div id="stateBox">
    Not started.
  </div>

  <hr/>

  <h3>Host Controls</h3>
  <div class="row">
    <input id="hostA" placeholder="Player A name (optional)"/>
    <input id="hostB" placeholder="Player B name (optional)"/>
  </div>
  <button onclick="startGame()">Start / Reset Game (Host)</button>

  <hr/>

  <h3>Actions (Players only)</h3>
  <div class="row">
    <button onclick="act('attack')">‚öîÔ∏è Attack</button>
    <button onclick="act('defend')">üõ°Ô∏è Defend</button>
    <button onclick="act('heal')">‚ú® Heal</button>
  </div>
</div>

<div class="card">
  <h3>Battle Log</h3>
  <div id="log">Not connected.</div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  let joinedRoom = "";
  let myRole = "";

  function setStatus(txt){
    document.getElementById("statusPill").textContent = "Status: " + txt;
  }
  function setRole(txt){
    document.getElementById("rolePill").textContent = "Role: " + txt;
  }

  function clearLog(){
    document.getElementById("log").textContent = "";
  }

  function log(msg){
    const box = document.getElementById("log");
    box.textContent += (box.textContent ? "\n" : "") + msg;
    box.scrollTop = box.scrollHeight;
  }

  socket.on("connect", ()=>{
    clearLog();
    setStatus("connected");
    setRole("-");
    log("‚úÖ Connected to server!");
  });

  socket.on("disconnect", ()=>{
    setStatus("disconnected");
    log("‚ùå Disconnected.");
  });

  socket.on("serverHello", ()=>{ /* noop */ });

  socket.on("errorMsg", (msg)=>{
    log("‚ùå " + msg);
    alert(msg);
  });

  socket.on("joined", ({ room, role, seat })=>{
    joinedRoom = room;
    myRole = role;
    setRole(role + (seat ? (" ("+seat+")") : ""));
    log("‚úÖ Joined room: " + room + " as " + role + (seat ? (" seat "+seat) : ""));
  });

  socket.on("state", ({ room, game })=>{
    // render state
    const A = game.players.A;
    const B = game.players.B;
    const turn = game.turn;
    const started = game.started;

    const html =
      `<div class="pill">Room: ${room}</div>` +
      `<div class="pill">Started: ${started ? "yes" : "no"}</div>` +
      `<div class="pill">Turn: ${turn}</div>` +
      `<div style="margin-top:10px"></div>` +
      `<div class="pill">A: ${A.name} ‚Äî HP ${A.hp}${A.defending ? " (DEF)" : ""}</div>` +
      `<div class="pill">B: ${B.name} ‚Äî HP ${B.hp}${B.defending ? " (DEF)" : ""}</div>` +
      `<div style="margin-top:10px;border-top:1px dashed #6a7b5f;padding-top:10px"></div>` +
      `<div><b>Latest log:</b></div>` +
      `<div style="white-space:pre-wrap">${game.log.slice(-6).map(x=> "‚Ä¢ " + x.msg).join("\n")}</div>`;

    document.getElementById("stateBox").innerHTML = html;

    // also mirror log nicely
    clearLog();
    log("‚úÖ Connected to server!");
    game.log.slice(-20).forEach(x => log(x.msg));
  });

  function roomPass(){
    return {
      room: document.getElementById("room").value.trim(),
      pass: document.getElementById("pass").value.trim()
    };
  }

  function hostRoom(){
    const { room, pass } = roomPass();
    socket.emit("hostRoom", { room, pass });
    log("üéÆ Hosting room: " + room.toUpperCase());
  }

  function spectate(){
    const { room, pass } = roomPass();
    socket.emit("spectateRoom", { room, pass });
    log("üëÄ Watching room: " + room.toUpperCase());
  }

  function joinPlayer(){
    const { room, pass } = roomPass();
    const seat = document.getElementById("seat").value;
    const name = document.getElementById("myName").value.trim();
    socket.emit("joinPlayer", { room, pass, seat, name });
    log("üé≠ Joining as Player " + seat + "‚Ä¶");
  }

  function startGame(){
    const { room } = roomPass();
    const playerAName = document.getElementById("hostA").value.trim();
    const playerBName = document.getElementById("hostB").value.trim();
    socket.emit("startGame", { room, playerAName, playerBName });
    log("üèÅ Start game requested‚Ä¶");
  }

  function act(type){
    const { room } = roomPass();
    socket.emit("action", { room, type });
  }
</script>

</body>
</html>
