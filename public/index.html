<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Arena</title>

  <style>
    body{
      font-family: monospace;
      background:#dfe9d6;
      padding:14px;
    }
    .card{
      background:#fffdf1;
      border:2px solid #6a7b5f;
      border-radius:12px;
      padding:12px;
      margin-bottom:14px;
    }
    input,button{
      width:100%;
      padding:10px;
      margin-top:6px;
      border-radius:10px;
      border:1px solid #6a7b5f;
      font-size:16px;
      box-sizing:border-box;
    }
    button{
      font-weight:bold;
      cursor:pointer;
    }
    button:disabled{
      opacity:0.4;
      cursor:not-allowed;
    }
    #log{
      background:black;
      color:#00ff00;
      padding:10px;
      border-radius:10px;
      min-height:140px;
      white-space:pre-wrap;
    }
  </style>
</head>

<body>

<h2>üè∞ Arena</h2>

<div class="card">
  <h3>Join Room</h3>

  Room Code:
  <input id="room" value="ARENA"/>

  Password:
  <input id="pass" value="rose"/>

  <button onclick="connectHost()">Host (Play)</button>
  <button onclick="connectSpectate()">Spectate (Watch)</button>
</div>

<div class="card">
  <h3>Players</h3>

  Player A:
  <input id="a" value="PlayerA"/>

  Player B:
  <input id="b" value="PlayerB"/>

  <button onclick="startMatch()">Start Match</button>

  <button id="shareBtn" disabled onclick="shareResult()">
    Share Result üì≤
  </button>
</div>

<div class="card">
  <h3>Battle Log</h3>
  <div id="log">Not connected.</div>
</div>

<script src="/socket.io/socket.io.js"></script>

<script>
  const socket = io();
  let lastResult = "";

  function log(msg){
    const box = document.getElementById("log");
    box.textContent += "\n" + msg;
  }

  socket.on("connect", ()=>{
    document.getElementById("log").textContent = "";
    log("‚úÖ Connected to server!");
  });

  socket.on("matchResult", (data)=>{
    log("üì¢ Result received:");
    log(data.result);

    lastResult = data.result;
    document.getElementById("shareBtn").disabled = false;
  });

  function connectHost(){
    socket.emit("hostRoom", {
      room: room.value.trim(),
      pass: pass.value.trim()
    });
    log("üéÆ Hosting room: " + room.value);
  }

  function connectSpectate(){
    socket.emit("spectateRoom", {
      room: room.value.trim(),
      pass: pass.value.trim()
    });
    log("üëÄ Watching room: " + room.value);
  }

  function startMatch(){
    const A = a.value.trim();
    const B = b.value.trim();

    if(!A || !B){
      alert("Enter both names!");
      return;
    }

    const winner = Math.random() > 0.5 ? A : B;
    lastResult = `üèÜ Winner: ${winner}\n(${A} vs ${B})`;

    log("‚öî Match started...");
    log("üì§ Sending result...");

    socket.emit("matchResult", {
      room: room.value.trim(),
      password: pass.value.trim(),
      result: lastResult
    });

    document.getElementById("shareBtn").disabled = false;
  }

  function shareResult(){
    if(!lastResult) return;

    navigator.share({
      title: "Arena Match Result",
      text: lastResult
    });
  }
</script>

</body>
</html>
